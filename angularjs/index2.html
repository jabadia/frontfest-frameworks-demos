<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title>Demo</title>
	<style>
		html {
			font-family: 'Arial';
			font-size: 20px;
		}
		button {
			font-size: 18px;
			border-radius: 8px;
			min-height: 30px;
			margin: 5px 0;
			background: #eee;
		}
		.root {
			margin: 20px;
			padding: 20px;
			border: 2px solid green;
			color: green;
			border-radius: 8px;
		}
		my-directive {
			display: block;
			margin-top: 20px;
			padding: 20px;
			border: 2px solid blue;
			color: blue;
			border-radius: 8px;
		}

	</style>
</head>
<body ng-app="MyApp">
	<div ng-controller="MainCtrl">
		<div class="root">
			Hello {{greeting}}!<br>
			counter: {{counter}}<br>
			doubleCounter: {{doubleCounter}}<br>
			tripleCounter: {{tripleCounter}}<br>
			unrelated: {{unrelated}}<br>
			<button ng-click="increment()">increment</button><br>
			<button ng-click="incrementUnrelated()">increment unrelated</button><br>
			<my-directive my-counter='counter'></my-directive>
		</div>
	</div>

	<script src="./node_modules/angular/angular.js"></script>
	<script>
		
		var app = angular.module('MyApp', []);

		app.directive('myDirective', function() {
			return {
				template: `
				<div>myDirective</div>
				<b>{{myCounter}}</b><br>
				<button ng-click="myIncrement()">my increment</button>
				`,
				scope: {
					myCounter: '=',
				},
				link: function(scope, elem) {
					console.log(scope.myCounter);

					scope.myIncrement = function() {
						scope.myCounter += 5;
					};
				},
			};
		});

		app.controller('MainCtrl', function($scope) {

			$scope.greeting = "World";
			$scope.counter = 0;
			$scope.unrelated = 0;

			$scope.increment = function() {
				$scope.counter += 1;
			};

			$scope.incrementUnrelated = function() {
				$scope.unrelated += 100;
			};

			$scope.$watch('counter', function() {
				$scope.doubleCounter = $scope.counter * 2;
			});

			$scope.$watch(function() {
				console.log("checking doubleCounter with value", $scope.doubleCounter);
				return $scope.doubleCounter;	
			}, function() {
				console.log("updating tripleCounter");
				$scope.tripleCounter = $scope.doubleCounter * 3;
			})

		});

	</script>
</body>
</html>